# @package _global_

defaults:
  - discrete_diffusion_train_rope

trainer:
  val_check_interval: 5000

model:
  _target_: src.experimental.modules.dense_discrete_diffusion_module.DenseDiscreteDiffusionModule
  embedding_path: ./data/amazon/beauty/item_semantic_embeddings/flan-t5-xxl.pt

  dense_retrieval_update_frequency: 4
  dense_retrieval_loss_function:
    _target_: src.components.loss_functions.FullDenseRetrievalLoss
    contrastive_tau: 0.1
    normalize: false

  dense_retrieval_agrregation: "concat"
  dense_apply_halfway_embedding: true
  dense_retrieval_noise: "last-token-ar" # Options: "mask-random-item", "last-token-ar"

  diffusion_config:
    inference_type: "dense-retrieval"


  item_embedding_projection:
    _target_: torch.nn.Linear
    in_features: 640
    out_features: 4096
    # _target_: src.models.components.network_blocks.mlp.MLP
    # input_dim: 640
    # hidden_dim_list:
    # - 256
    # output_dim: 4096
    # activation:
    #   _target_: torch.nn.ReLU
    #   _partial_: true

  dense_retrieval_evaluator:
    _target_: src.components.eval_metrics.RetrievalEvaluator
    should_sample_negatives_from_vocab: False
    placeholder_token_buffer: null
    top_k_list:
      - !!int 5
      - !!int 10
    
    percentage_list:
      - !!int 100

    seq_len_list:
      - !!int 100
    
    metrics:
      recall:
        _target_: src.components.eval_metrics.Recall
        _partial_: true
      ndcg:
        _target_: src.components.eval_metrics.NDCG
        _partial_: true
